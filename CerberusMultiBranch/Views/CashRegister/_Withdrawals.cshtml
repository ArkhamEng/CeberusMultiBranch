@model IEnumerable<CerberusMultiBranch.Models.Entities.Operative.CashDetail>

<div id="ModalDetails" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content panel panel-danger panel-group">
            <div class="modal-header panel-heading">
                <h4 class="modal-title">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <span class="fa fa-dollar"></span>
                    Retiros de caja
                </h4>
            </div>
            <div class="modal-body panel-group">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="form-group col-md-3">
                            <label class="control-label">
                                Cantidad
                            </label>
                            <div class="input-group">
                                <span class="input-group-addon"><a class="fa fa-dollar"></a></span>
                                <input class="form-control" type="number" id="txtAmount" />
                            </div>
                        </div>
                        <div class="col-md-9">
                            <label class="control-label">
                                Causa de retiro
                            </label>
                            <div class="input-group">
                                <span class="input-group-addon"><a class="fa fa-list-alt"></a></span>
                                @Html.DropDownList("CauseId", (SelectList)ViewBag.Causes, "", new { @class = "form-control" })
                                <span class="input-group-btn">
                                    <button class="btn btn-warning" id="btnAdd" title="Agregar retiro">
                                        <span class="glyphicon glyphicon-plus"></span>
                                    </button>
                                </span>
                            </div>
                        </div>

                        <div class="form-group col-md-12">
                            <label class="control-label">
                                Comentario
                            </label>
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-comment-o"></i></span>
                                <textarea class="form-control"  id="txtComment"  rows="2" cols="1" />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-body">
                        <table id="tbWithdrawals" class="table table-striped small">
                            <thead>
                                <tr>
                                    <th>@Html.DisplayName("Causa de retiro")</th>
                                    <th>@Html.DisplayNameFor(m => m.InsDate)</th>
                                    <th>@Html.DisplayNameFor(m => m.Amount)</th>
                                    <th>@Html.DisplayNameFor(m => m.Comment)</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>
                                            @Html.DisplayFor(m => item.Cause.Name)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(m => item.InsDate)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(m => item.Amount)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(m => item.Comment)
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function ()
    {
        Paginate("#tbWithdrawals", 8);

        $("#ModalDetails").modal("show");

        $("#btnAdd").off('click').click(function ()
        {
            var data = { amount: $("#txtAmount").val(), comment: $("#txtComment").val(), causeId: $("#CauseId").val() };

            ExecuteAjax('@Url.Action("AddWithdrawal","CashRegister")', data, function (data)
            {
                if (data == "OK")
                    window.location = '@Url.Action("Index")';
                else
                {
                    $("#ModalDetails").off('hidden.bs.modal').on('hidden.bs.modal', function ()
                    {
                        ShowMessage("Error al retirar", "Ocurrio un error al agregar el retiro", "warning");
                    });

                    $("#ModalDetails").modal("hide");
                }
            });
        });
    });
</script>